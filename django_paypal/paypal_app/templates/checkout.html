<!DOCTYPE html>
<html>
<head>
    <title>PayPal Checkout</title>

    <!-- OFFICIAL PAYPAL SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD&intent=capture"></script>
</head>
<body>

<h2>Pay with PayPal</h2>

<div id="paypal-button-container"></div>

<script>
paypal.Buttons({
    createOrder: function (data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: {
                    value: "10.00"
                }
            }]
        });
    },

    onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
            fetch("{% url 'payment_success' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify(details)
            }).then(() => {
                window.location.href = "{% url 'payment_success' %}";
            });
        });
    },

    onCancel: function () {
        window.location.href = "{% url 'payment_failed' %}";
    },

    onError: function (err) {
        console.error("PayPal error:", err);
        alert("Payment error â€“ check console");
    }
}).render("#paypal-button-container");
</script>

</body>
</html>
